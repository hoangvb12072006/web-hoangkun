<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Necesse Game - Gameplay</title>
    <style>
        body { margin: 0; background: #3e5d39; overflow: hidden; color: white; font-family: 'Courier New', Courier, monospace; }
        canvas { display: block; image-rendering: pixelated; }
        .ui { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="ui">
        <div id="nameDisplay">NGƯỜI CHƠI: ...</div>
        <a href="index.html" style="color: #ffcc00; text-decoration: none;">[ THOÁT ]</a>
    </div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Lấy tên nhân vật từ Sảnh
        document.getElementById('nameDisplay').innerText = "NGƯỜI CHƠI: " + (localStorage.getItem('charName') || "HoangKun");

        // KHAI BÁO ẢNH - Bạn hãy đổi tên file cho đúng với file bạn đã up lên GitHub
        const imgPlayer = new Image();
        imgPlayer.src = 'nhan-vat.png'; // Đổi thành tên file nhân vật của bạn

        const imgGrass = new Image();
        imgGrass.src = 'co.png'; // Đổi thành tên file nền cỏ của bạn

        // Tọa độ nhân vật
        let p = { x: canvas.width/2, y: canvas.height/2, speed: 5, frameX: 0, frameY: 0 };
        let keys = {};

        window.onkeydown = (e) => keys[e.code] = true;
        window.onkeyup = (e) => keys[e.code] = false;

        function update() {
            if (keys['ArrowUp'] || keys['KeyW']) { p.y -= p.speed; p.frameY = 1; }
            if (keys['ArrowDown'] || keys['KeyS']) { p.y += p.speed; p.frameY = 0; }
            if (keys['ArrowLeft'] || keys['KeyA']) { p.x -= p.speed; p.frameY = 2; }
            if (keys['ArrowRight'] || keys['KeyD']) { p.x += p.speed; p.frameY = 3; }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 1. Vẽ nền cỏ lặp lại
            if (imgGrass.complete) {
                for(let x=0; x<canvas.width; x+=100) {
                    for(let y=0; y<canvas.height; y+=100) {
                        ctx.drawImage(imgGrass, x, y, 100, 100);
                    }
                }
            }

            // 2. Vẽ nhân vật (Cắt từ tấm Sprite bạn gửi)
            if (imgPlayer.complete) {
                // Cắt khung hình 48x48 từ tấm ảnh to
                ctx.drawImage(imgPlayer, p.frameX * 48, p.frameY * 48, 48, 48, p.x, p.y, 64, 64);
            }

            update();
            requestAnimationFrame(draw);
        }

        // Bắt đầu game
        draw();
    </script>
</body>
</html>
