<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Necesse Survival Pro - by HoangKun</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #000; font-family: 'VT323', monospace; overflow: hidden; touch-action: none; }
        
        /* LOBBY */
        #lobby {
            width: 100vw; height: 100vh; position: fixed; inset: 0;
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://hoanghamobile.com/tin-tuc/wp-content/uploads/2024/11/pixels-game-thumb.jpg');
            background-size: cover; background-position: center; display: flex; justify-content: center; align-items: center; z-index: 100;
        }
        .wood-panel { background: #5d4037; border: 6px solid #3d251e; padding: 30px; color: #f4e4bc; box-shadow: 10px 10px 0px #000; text-align: center; }
        .btn { background: #8d6e63; border: 4px solid #3d251e; border-bottom: 8px solid #2d1b16; color: #f4e4bc; padding: 10px 20px; font-size: 2rem; cursor: pointer; margin-top: 15px; display: block; width: 100%; font-family: 'VT323'; }
        .btn:active { transform: translateY(4px); border-bottom-width: 4px; }

        /* GAME CANVAS */
        #game-canvas { display: none; background: #2d6a4f; position: fixed; inset: 0; z-index: 10; cursor: crosshair; }

        /* UI LAYER */
        #ui { display: none; position: fixed; inset: 0; z-index: 50; pointer-events: none; }
        .hud { pointer-events: auto; position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.6); padding: 10px; color: #fff; border: 2px solid #f4e4bc; font-size: 1.2rem; }
        .minimap { position: absolute; top: 10px; right: 10px; width: 120px; height: 120px; background: rgba(0,0,0,0.5); border: 2px solid #fff; }
        
        /* CRAFTING MENU */
        #crafting { pointer-events: auto; position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px; }
        .craft-item { background: #3d251e; border: 2px solid #f4e4bc; color: #fff; padding: 5px; font-size: 0.9rem; cursor: pointer; text-align: center; }
        .craft-item:hover { background: #5d4037; }

        /* MOBILE CONTROLS */
        .joy { pointer-events: auto; position: absolute; bottom: 30px; left: 30px; width: 100px; height: 100px; background: rgba(255,255,255,0.2); border-radius: 50%; }
        .knob { position: absolute; top: 50%; left: 50%; width: 40px; height: 40px; background: #fff; border-radius: 50%; transform: translate(-50%,-50%); }
        .hit-btn { pointer-events: auto; position: absolute; bottom: 40px; right: 40px; width: 80px; height: 80px; background: #e67e22; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: #fff; font-size: 1.5rem; border: 4px solid #d35400; box-shadow: 0 5px 0 #a04000; }
    </style>
</head>
<body onclick="document.getElementById('bgMusic').play().catch(()=>{})">

    <audio id="bgMusic" loop><source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3"></audio>
    <audio id="hitSnd"><source src="https://www.fesliyanstudios.com/play-mp3/6"></audio>

    <div id="lobby">
        <div class="wood-panel">
            <h1 style="font-size: 4rem;">NECESSE LITE</h1>
            <input type="text" id="pName" placeholder="T√äN B·∫†N..." style="padding: 10px; width: 100%; font-family: 'VT323'; font-size: 1.5rem; text-align: center;">
            <button class="btn" onclick="start()">B·∫ÆT ƒê·∫¶U SINH T·ªíN</button>
        </div>
    </div>

    <canvas id="game-canvas"></canvas>

    <div id="ui">
        <div class="hud">
            <div>üí∞ V√ÄNG: <span id="gold">0</span></div>
            <div>üå≤ G·ªñ: <span id="wood">0</span></div>
            <div>ü™® ƒê√Å: <span id="stone">0</span></div>
            <div style="color: #00ff00;">üõ† TOOL: <span id="tool">Tay kh√¥ng</span></div>
        </div>

        <div id="crafting">
            <div class="craft-item" onclick="craft('axe')">R√åU<br>(15 G·ªó)</div>
            <div class="craft-item" onclick="craft('pickaxe')">C√öP<br>(15 ƒê√°)</div>
            <div class="craft-item" onclick="craft('sword')">KI·∫æM<br>(10 G·ªó, 10 ƒê√°)</div>
        </div>

        <div class="minimap"><canvas id="m-canvas" width="120" height="120"></canvas></div>
        <div class="joy" id="joy"><div class="knob" id="knob"></div></div>
        <div class="hit-btn" onclick="hit()">HIT</div>
    </div>

    <script>
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const mCtx = document.getElementById('m-canvas').getContext('2d');
        const hitSnd = document.getElementById('hitSnd');

        let worldSize = 2500;
        let p = { x: 1250, y: 1250, name: "", speed: 5, tool: "none", hitting: false };
        let resources = { gold: 0, wood: 0, stone: 0 };
        let objs = []; 
        let mobs = [];
        let keys = {};
        let joyDir = { x: 0, y: 0 };

        function start() {
            p.name = document.getElementById('pName').value || "Player";
            document.getElementById('lobby').style.display = 'none';
            canvas.style.display = 'block';
            document.getElementById('ui').style.display = 'block';
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            initWorld();
            requestAnimationFrame(loop);
        }

        function initWorld() {
            for(let i=0; i<60; i++) objs.push({x:Math.random()*worldSize, y:Math.random()*worldSize, type:'tree', hp:40});
            for(let i=0; i<40; i++) objs.push({x:Math.random()*worldSize, y:Math.random()*worldSize, type:'rock', hp:60});
            for(let i=0; i<15; i++) mobs.push({x:Math.random()*worldSize, y:Math.random()*worldSize, hp:30, vx:(Math.random()-0.5)*2, vy:(Math.random()-0.5)*2});
        }

        function craft(type) {
            if(type === 'axe' && resources.wood >= 15) { resources.wood -= 15; p.tool = 'axe'; }
            else if(type === 'pickaxe' && resources.stone >= 15) { resources.stone -= 15; p.tool = 'pickaxe'; }
            else if(type === 'sword' && resources.wood >= 10 && resources.stone >= 10) { 
                resources.wood -= 10; resources.stone -= 10; p.tool = 'sword'; 
            } else { alert("Kh√¥ng ƒë·ªß nguy√™n li·ªáu!"); return; }
            document.getElementById('tool').innerText = p.tool.toUpperCase();
            updateUI();
        }

        function hit() {
            hitSnd.currentTime = 0; hitSnd.play();
            p.hitting = true;
            // Farm t√†i nguy√™n
            objs.forEach((o, i) => {
                if(Math.hypot(p.x-o.x, p.y-o.y) < 80) {
                    let dmg = 10;
                    if(p.tool === 'axe' && o.type === 'tree') dmg = 25;
                    if(p.tool === 'pickaxe' && o.type === 'rock') dmg = 25;
                    o.hp -= dmg;
                    if(o.hp <= 0) {
                        if(o.type === 'tree') resources.wood += 5; else resources.stone += 5;
                        resources.gold += 5; objs.splice(i, 1);
                    }
                }
            });
            // ƒê√°nh qu√°i
            mobs.forEach((m, i) => {
                if(Math.hypot(p.x-m.x, p.y-m.y) < 80) {
                    m.hp -= (p.tool === 'sword' ? 15 : 5);
                    if(m.hp <= 0) { resources.gold += 20; mobs.splice(i, 1); }
                }
            });
            updateUI();
            setTimeout(() => p.hitting = false, 150);
        }

        function updateUI() {
            document.getElementById('gold').innerText = resources.gold;
            document.getElementById('wood').innerText = resources.wood;
            document.getElementById('stone').innerText = resources.stone;
        }

        window.onkeydown = e => keys[e.code] = true;
        window.onkeyup = e => keys[e.code] = false;

        const joy = document.getElementById('joy');
        joy.ontouchmove = e => {
            let t = e.touches[0]; let r = joy.getBoundingClientRect();
            let dx = t.clientX - (r.left + 50), dy = t.clientY - (r.top + 50);
            let d = Math.min(Math.sqrt(dx*dx+dy*dy), 50);
            let a = Math.atan2(dy, dx);
            joyDir = { x: Math.cos(a)*(d/50), y: Math.sin(a)*(d/50) };
            document.getElementById('knob').style.transform = `translate(calc(-50% + ${Math.cos(a)*d}px), calc(-50% + ${Math.sin(a)*d}px))`;
        };
        joy.ontouchend = () => { joyDir = {x:0, y:0}; document.getElementById('knob').style.transform = 'translate(-50%,-50%)'; };

        function loop() {
            if(keys['KeyW']) p.y -= p.speed; if(keys['KeyS']) p.y += p.speed;
            if(keys['KeyA']) p.x -= p.speed; if(keys['KeyD']) p.x += p.speed;
            p.x += joyDir.x * p.speed; p.y += joyDir.y * p.speed;
            p.x = Math.max(0, Math.min(worldSize, p.x)); p.y = Math.max(0, Math.min(worldSize, p.y));

            let cx = p.x - canvas.width/2, cy = p.y - canvas.height/2;
            ctx.fillStyle = '#2d6a4f'; ctx.fillRect(0,0, canvas.width, canvas.height);

            objs.forEach(o => {
                if(o.type === 'tree') {
                    ctx.fillStyle = '#5d4037'; ctx.fillRect(o.x-cx-5, o.y-cy, 10, 20);
                    ctx.fillStyle = '#1b4332'; ctx.beginPath(); ctx.arc(o.x-cx, o.y-cy-15, 20, 0, 7); ctx.fill();
                } else {
                    ctx.fillStyle = '#7f8c8d'; ctx.beginPath(); ctx.ellipse(o.x-cx, o.y-cy, 20, 15, 0, 0, 7); ctx.fill();
                }
            });

            mobs.forEach(m => {
                m.x += m.vx; m.y += m.vy;
                if(m.x<0 || m.x>worldSize) m.vx *= -1; if(m.y<0 || m.y>worldSize) m.vy *= -1;
                ctx.fillStyle = '#ff4d4d'; ctx.beginPath(); ctx.arc(m.x-cx, m.y-cy, 15, 0, 7); ctx.fill();
            });

            ctx.fillStyle = p.hitting ? '#fff' : '#e67e22';
            ctx.fillRect(canvas.width/2-20, canvas.height/2-20, 40, 40);
            ctx.fillStyle = '#fff'; ctx.fillText(p.name, canvas.width/2-20, canvas.height/2-30);

            mCtx.fillStyle = '#000'; mCtx.fillRect(0,0,120,120);
            mCtx.fillStyle = '#f00'; mCtx.fillRect((p.x/worldSize)*120, (p.y/worldSize)*120, 4, 4);

            requestAnimationFrame(loop);
        }
    </script>
</body>
</html>
